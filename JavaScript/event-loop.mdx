# 이벤트 루프란

이벤트 루프란 태스크가 들어오길 기다렸다가 태스크가 들어오면 이를 처리하고 처리할 태스크가 없는 경우엔 잠드는 끊임없이 돌아가는 자바스크립트 내 루프입니다 <br/>
태스크는 하나의 집합을 이룹니다 자바스크립트 엔진은 집합을 이루고 있는 태스크들을 차례대로 처리하고 새로운 태스크가 추가될 때까지 기다립니다 <br/>
태스크를 기다리는 동안엔 CPU 자원 소비는 0에 가까워지고 엔진은 잠들게 됩니다 <br/>
새로운 태스크는 엔진이 바쁠 때 추가될 수도 있는데 이때 이 태스크는 큐에 추가됩니다 <br/>
이렇게 태스크가 추가되는 큐는 V8 용어로 **매크로태스크 큐**라고 부릅니다 <br/>

### 매크로태스크 큐

매크로태스크 큐는 이벤트 루프에서 **기본적인 작업 단위를 저장하는 큐**입니다 <br/>
대표적인 예시는 `setTimeout`, `setInterval`, `setImmediate`, `I/O`, `UI 이벤트 처리` 등이 있습니다 <br/>
매크로태스크는 **이벤트 루프의 한 사이클당 하나씩** 처리되며 각 매크로태스크가 끝난 후 렌더링이 일어날 수 있습니다 <br/>

매크로태스크 처리 중에 생성된 마이크로태스크는 매크로태스크가 끝난 직후 즉시 처리됩니다 <br/>

### 마이크로태스크 큐

마이크로태스크 큐는 **매크로태스크가 끝난 직후**에 처리되는 태스크들의 큐입니다 <br/>
대표적인 예시로는 `Promise.then`, `catch`, `finally`, `queueMicrotask`, `MutationObserver` 등이 있습니다 <br/>
마이크로태스크는 **렌더링 전에 모두 처리**되며 매크로태스크보다 **우선순위가 높습니다** <br/>

마이크로태스크가 반복적으로 발생하면 렌더링이 지연될 수 있기 때문에 주의해서 사용해야 합니다 <br/>

### 자바스크립트 엔진이 돌아가는 알고리즘 일반화

- **처리해야 할 태스크가 있는 경우** 먼저 들어온 태스크부터 순차적으로 처리합니다
- **처리해야 할 태스크가 없는 경우** 잠들었다가 새로운 태스크가 추가되면 다시 1로 돌아갑니다

### 이벤트 루프 정리

1. 매크로태스크 하나 처리
2. 그 안에서 생긴 마이크로태스크 모두 처리
3. 렌더링(필요한 경우)
4. 다음 매크로태스크 처리
